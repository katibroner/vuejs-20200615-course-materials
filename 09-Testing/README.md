# Тестирование

## Зачем нужны тесты

- Автоматизация проверки корректности работы -- не требуется помнить что нужно проверять, и каждый раз проверять вручную;
- Простая проверка и отладка одного модуля -- не требуется создавать окружение для ручного тестирования;
- Упрощение рефакторинга -- не так страшно менять код, когда легко проверить, что он работает;
- Документация -- тесты описывают, как должен работать модуль (см. [BDD](https://ru.wikipedia.org/wiki/BDD_(программирование)));
- Необходимость для CI / CD.

## Виды тестов

- Unit-тесты (модульные тесты) -- проверяют отдельный изолированный юнит (модуль) системы;
- Интеграционные тесты - проверяют;
- Snapshot тесты -- проверяют "снимок" результата рендеринга;
- Screenshot тесты - тестирование скриншотами. Позволяет проверить визуальный результат, соответствие дизайну, в не зависимости от разметки и реализации;
- e2e тестирование (end-to-end) -- проверяются сценарии использования приложения целиком от начала до конца "снаружи", как это бы делал пользователь, через взаимодействие со стороны браузера.

## Фреймворки тестирования

Теоретически можно писать тесты без использования каких-либо библиотек. Но фреймворки и различные вспомогательные библиотеки тестирования решают за нас основные задачи:
- Проверка соответствия ожидаемого и действительности. Хотя в nodejs есть стандартный модуль assert, который может проверять, например, равенство двух значений, часто нам требуются более сложные проверки;
- Описание тестов в удобном читаемом виде (BDD);
- Запуск тестов, в том числе:
    - Обнаружение тестов;
    - Распараллеливание тестирования;
    - Вывод отчёта;
- Создание окружения для тестирования: mock-и, подмена глобальных сущностей, имитация таймеров и т.д.;
- Фреймворк-специфические вещи, например, создание удобной для тестирования обёртки над Vue компонентами.

## vue-test-utils + jest

Мы будем использовать `Jest` и пакет `@vue/test-utils`, который предоставляет инструменты для тестирования Vue приложений.

Можно настроить `jest` по документации, а можно воспользоваться `@vue/cli-plugin-unit-jest`. Плагин поставит все необходимые зависимости и создаст основу для [конфига](https://github.com/vuejs/vue-cli/blob/dev/packages/%40vue/cli-plugin-unit-jest/presets/default/jest-preset.js).

## Что тестировать во Vue компонентах

В классическом unit тестировании мы тестируем функции на соответствие результата (выхода) ожидаемому при определённых параметрах (входе). 

Vue-компонент сложнее простой чистой функции, у которой есть входные аргументы и возвращаемое значение. Но удовлетворяет той же концепции:
- Вход:
    - Входные параметры компонента
    - Атрибуты
    - Слоты
    - Взаимодействие пользователя
    - И т.д.
- Выход:
    - Результат рендеринга, HTML разметка
    - Порождённые события
    - И т.п.

Таким образом тестировать требуется то, как компонент взаимодействует с другими компонентами, его интерфейс взаимодействия, и то, как компонент взаимодействует с пользователем.

В остальном же компонент -- это чёрный ящик. До тех пор, пока его методы, вычисляемые свойства и т.д. не являются частью интерфейса взаимодействия, они не являются целью тестирования.

## Ссылки

- Jest: [https://jestjs.io/](https://jestjs.io/)
- @vue/test-utils: [https://jestjs.io/](https://jestjs.io/)
- @vue/cli-plugin-unit-jest: [https://cli.vuejs.org/core-plugins/unit-jest.html](https://cli.vuejs.org/core-plugins/unit-jest.html)
- Автоматическое тестирование c использованием фреймворка Mocha: [https://learn.javascript.ru/testing-mocha](https://learn.javascript.ru/testing-mocha)
- Интересный доклад про e2e тестирование на Cypress: [HolyJS-Piter 2019 | Basarat Ali Syed — Documenting application behaviours with E2E tests](https://www.youtube.com/watch?v=3oCDjj_AtaE)
- Доклад про необычное тестирование: [HolyJS-Piter 2019 | Назим Гафаров — Очень странное тестирование](https://www.youtube.com/watch?v=H-cBhNMxlCw)
- [Jest Architecture](https://www.youtube.com/watch?v=3YDiloj8_d0)
- [TDD](https://ru.wikipedia.org/wiki/Разработка_через_тестирование)
